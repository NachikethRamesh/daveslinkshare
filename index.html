<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dave's Links</title>
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:system-ui,sans-serif;background:#f5f5f5;padding:20px;color:#333}
        .app{max-width:600px;margin:0 auto}
        .card{background:#fff;padding:20px;border-radius:8px;box-shadow:0 2px 4px rgba(0,0,0,0.1);margin-bottom:20px}
        h1{text-align:center;color:#444;margin-bottom:20px}
        input{width:100%;padding:12px;border:1px solid #ddd;border-radius:6px;font-size:16px;margin-bottom:10px}
        input:focus{outline:none;border-color:#007acc}
        button{width:100%;padding:12px;background:#007acc;color:#fff;border:none;border-radius:6px;font-size:16px;cursor:pointer}
        button:hover{background:#005a99}
        button:disabled{background:#ccc;cursor:not-allowed}
        .link{display:flex;justify-content:space-between;align-items:center;padding:12px;border-bottom:1px solid #eee;margin-bottom:8px}
        .link:last-child{border-bottom:none;margin-bottom:0}
        .link-info{flex:1;margin-right:10px}
        .link-title{font-weight:500;margin-bottom:2px}
        .link-url{color:#007acc;text-decoration:none;font-size:14px;word-break:break-all}
        .link-url:hover{text-decoration:underline}
        .link-time{font-size:12px;color:#999;margin-top:2px}
        .link-actions{display:flex;gap:5px}
        .btn-sm{padding:6px 12px;font-size:12px;border-radius:4px}
        .btn-copy{background:#28a745}
        .btn-delete{background:#dc3545}
        .empty{text-align:center;color:#666;padding:40px}
        .status{position:fixed;top:20px;right:20px;padding:10px 15px;border-radius:4px;color:#fff;font-size:14px;display:none;z-index:1000}
        .success{background:#28a745}
        .error{background:#dc3545}
        .config-warning{background:#fff3cd;border:1px solid #ffeaa7;padding:15px;border-radius:6px;margin-bottom:20px;color:#856404}
        @media(max-width:600px){
            body{padding:10px}
            .link{flex-direction:column;align-items:stretch}
            .link-info{margin-right:0;margin-bottom:10px}
        }
    </style>
</head>
<body>
    <div class="app">
        <h1>üì± Dave's Links</h1>
        
        <div id="configWarning" class="config-warning" style="display:none">
            <strong>‚ö†Ô∏è Setup Required:</strong> Edit config.js with your JSONBin credentials for cross-device sync.
        </div>
        
        <div class="card">
            <input type="url" id="url" placeholder="Paste link here..." required>
            <input type="text" id="title" placeholder="Optional title">
            <button id="addBtn" onclick="addLink()">Add Link</button>
        </div>
        
        <div class="card">
            <div id="links">
                <div class="empty">Loading...</div>
            </div>
        </div>
        
        <div id="status" class="status"></div>
    </div>
    
    <script src="config.js"></script>
    <script>
        let links = [];
        
        // Check configuration
        const isConfigured = CONFIG.BIN_ID !== 'YOUR_BIN_ID_HERE' && CONFIG.API_KEY !== 'YOUR_API_KEY_HERE';
        if (!isConfigured) {
            document.getElementById('configWarning').style.display = 'block';
        }
        
        // API functions
        async function cloudSave(data) {
            if (!isConfigured) return false;
            try {
                const response = await fetch(`https://api.jsonbin.io/v3/b/${CONFIG.BIN_ID}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Master-Key': CONFIG.API_KEY
                    },
                    body: JSON.stringify({links: data})
                });
                return response.ok;
            } catch {
                return false;
            }
        }
        
        async function cloudLoad() {
            if (!isConfigured) return [];
            try {
                const response = await fetch(`https://api.jsonbin.io/v3/b/${CONFIG.BIN_ID}`, {
                    headers: {'X-Master-Key': CONFIG.API_KEY}
                });
                if (response.ok) {
                    const result = await response.json();
                    return result.record?.links || [];
                }
            } catch {}
            return [];
        }
        
        // Storage functions
        function localSave(data) {
            localStorage.setItem('daveLinks', JSON.stringify(data));
        }
        
        function localLoad() {
            return JSON.parse(localStorage.getItem('daveLinks') || '[]');
        }
        
        async function saveLinks(data) {
            localSave(data);
            if (isConfigured) {
                const success = await cloudSave(data);
                showStatus(success ? 'Synced to cloud!' : 'Saved locally', success ? 'success' : 'error');
            } else {
                showStatus('Saved locally', 'success');
            }
        }
        
        async function loadLinks() {
            if (isConfigured) {
                const cloudData = await cloudLoad();
                if (cloudData.length > 0) {
                    links = cloudData;
                    localSave(cloudData); // Backup locally
                    renderLinks();
                    return;
                }
            }
            
            // Fallback to local
            links = localLoad();
            renderLinks();
        }
        
        // UI functions
        function renderLinks() {
            const container = document.getElementById('links');
            if (links.length === 0) {
                container.innerHTML = '<div class="empty">No links saved yet</div>';
                return;
            }
            
            container.innerHTML = links.map(link => `
                <div class="link">
                    <div class="link-info">
                        <div class="link-title">${escapeHtml(link.title)}</div>
                        <a href="${link.url}" target="_blank" class="link-url">${escapeHtml(link.url)}</a>
                        <div class="link-time">${timeAgo(link.timestamp)}</div>
                    </div>
                    <div class="link-actions">
                        <button class="btn-sm btn-copy" onclick="copyLink('${link.url}')">Copy</button>
                        <button class="btn-sm btn-delete" onclick="deleteLink('${link.id}')">Delete</button>
                    </div>
                </div>
            `).join('');
        }
        
        async function addLink() {
            const urlInput = document.getElementById('url');
            const titleInput = document.getElementById('title');
            const addBtn = document.getElementById('addBtn');
            
            const url = urlInput.value.trim();
            const title = titleInput.value.trim();
            
            if (!url) {
                showStatus('Please enter a URL', 'error');
                return;
            }
            
            addBtn.disabled = true;
            
            const newLink = {
                id: Date.now().toString(),
                url,
                title: title || url,
                timestamp: new Date().toISOString()
            };
            
            links.unshift(newLink);
            await saveLinks(links);
            
            urlInput.value = '';
            titleInput.value = '';
            urlInput.focus();
            
            renderLinks();
            addBtn.disabled = false;
        }
        
        async function deleteLink(id) {
            links = links.filter(link => link.id !== id);
            await saveLinks(links);
            renderLinks();
        }
        
        async function copyLink(url) {
            try {
                await navigator.clipboard.writeText(url);
                showStatus('Copied!', 'success');
            } catch {
                // Fallback
                const ta = document.createElement('textarea');
                ta.value = url;
                document.body.appendChild(ta);
                ta.select();
                document.execCommand('copy');
                document.body.removeChild(ta);
                showStatus('Copied!', 'success');
            }
        }
        
        // Utility functions
        function showStatus(message, type) {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = `status ${type}`;
            status.style.display = 'block';
            setTimeout(() => status.style.display = 'none', 2000);
        }
        
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        function timeAgo(timestamp) {
            const diff = Date.now() - new Date(timestamp);
            if (diff < 60000) return 'now';
            if (diff < 3600000) return Math.floor(diff/60000) + 'm';
            if (diff < 86400000) return Math.floor(diff/3600000) + 'h';
            if (diff < 604800000) return Math.floor(diff/86400000) + 'd';
            return new Date(timestamp).toLocaleDateString();
        }
        
        // Initialize
        document.getElementById('url').addEventListener('keypress', e => {
            if (e.key === 'Enter') addLink();
        });
        
        document.getElementById('url').focus();
        loadLinks();
    </script>
</body>
</html>
